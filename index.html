<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amsterdam News Hub - Live Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Libre+Baskerville:wght@400;700&family=Old+Standard+TT:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Libre Baskerville', serif;
            background: #f8f8f8;
        }
        .headline-font {
            font-family: 'Playfair Display', serif;
            font-weight: 900;
            letter-spacing: -0.02em;
        }
        .subhead-font {
            font-family: 'Old Standard TT', serif;
            letter-spacing: 0.05em;
        }
        .newspaper-border {
            border-top: 3px solid #000;
            border-bottom: 1px solid #000;
        }
        .news-card {
            transition: transform 0.2s;
            border: 1px solid #ddd;
        }
        .news-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .highlight-image {
            border: 2px solid #000;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .spinning {
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        .divider {
            height: 1px;
            background: repeating-linear-gradient(
                90deg,
                #000,
                #000 5px,
                transparent 5px,
                transparent 10px
            );
        }
        .ornamental-line {
            text-align: center;
            border-bottom: 2px solid #000;
            line-height: 0.1em;
            margin: 2rem 0;
        }
        .ornamental-line span {
            background: #f8f8f8;
            padding: 0 1rem;
            font-size: 1.5rem;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 z-50 flex items-center justify-center hidden" style="background: rgba(255,255,255,0.95);">
        <div class="bg-white rounded-lg p-8 shadow-2xl text-center border-4 border-black">
            <div class="text-4xl mb-4 spinning">⚙</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2 headline-font">UPDATING EDITION</h3>
            <p class="text-gray-600 subhead-font text-sm">Fetching latest dispatches from Dutch sources</p>
            <div class="mt-4 flex justify-center gap-2">
                <span class="w-2 h-2 bg-black rounded-full animate-bounce" style="animation-delay: 0s"></span>
                <span class="w-2 h-2 bg-black rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                <span class="w-2 h-2 bg-black rounded-full animate-bounce" style="animation-delay: 0.4s"></span>
            </div>
        </div>
    </div>

    <!-- Masthead -->
    <header class="bg-white border-b-4 border-black">
        <div class="container mx-auto px-4 py-2">
            <div class="text-center newspaper-border py-4">
                <p class="text-xs subhead-font tracking-widest mb-2">ESTABLISHED 2024 • ROTTERDAM EDITION</p>
                <h1 class="text-5xl md:text-7xl headline-font mb-2">AMSTERDAM DISPATCH</h1>
                <p class="text-sm subhead-font tracking-wider">Regional News & Intelligence from Dutch Sources</p>
            </div>
            <div class="flex justify-between items-center py-3 border-t border-b border-gray-300">
                <div class="text-xs subhead-font">
                    <span id="currentDate"></span> • <span id="currentTime"></span>
                </div>
                <button onclick="refreshNews()" id="refreshBtn" class="border-2 border-black px-4 py-1 text-xs subhead-font tracking-wider hover:bg-black hover:text-white transition-all">
                    <span id="refreshIcon">↻</span> UPDATE EDITION
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-black text-white">
        <div class="container mx-auto px-4">
            <div class="flex justify-center gap-8 py-2 text-xs subhead-font tracking-widest">
                <a href="#highlights" class="hover:underline">HIGHLIGHTS</a>
                <a href="#crime" class="hover:underline">CRIME</a>
                <a href="#politics" class="hover:underline">POLITICS</a>
                <a href="#transport" class="hover:underline">TRANSPORT</a>
                <a href="#culture" class="hover:underline">CULTURE</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 bg-white">
        
        <!-- Breaking News Highlights -->
        <section id="highlights" class="mb-12">
            <div class="text-center mb-8">
                <h2 class="text-4xl headline-font mb-2">BREAKING DEVELOPMENTS</h2>
                <div class="divider w-32 mx-auto"></div>
                <p class="text-xs subhead-font tracking-wider mt-2">VERIFIED BY MULTIPLE AGENCIES</p>
            </div>
            
            <div id="highlightsContainer" class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Highlights will be loaded here dynamically -->
            </div>
        </section>

        <div class="ornamental-line"><span>❦</span></div>

        <!-- Crime & Safety Section -->
        <section id="crime" class="mb-12">
            <h2 class="text-3xl headline-font mb-6 text-center">CRIME & PUBLIC SAFETY</h2>
            <div id="crimeContainer" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Crime articles will be loaded here dynamically -->
            </div>
        </section>

        <div class="ornamental-line"><span>❦</span></div>

        <!-- Politics Section -->
        <section id="politics" class="mb-12">
            <h2 class="text-3xl headline-font mb-6 text-center">POLITICS & GOVERNMENT</h2>
            <div id="politicsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Politics articles will be loaded here dynamically -->
            </div>
        </section>

        <div class="ornamental-line"><span>❦</span></div>

        <!-- Transport & Culture in Two Columns -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            
            <!-- Transport Section -->
            <section id="transport">
                <h2 class="text-2xl headline-font mb-4 text-center border-b-2 border-black pb-2">TRANSPORT</h2>
                <div id="transportContainer" class="space-y-4">
                    <!-- Transport articles will be loaded here dynamically -->
                </div>
            </section>

            <!-- Culture Section -->
            <section id="culture">
                <h2 class="text-2xl headline-font mb-4 text-center border-b-2 border-black pb-2">CULTURE</h2>
                <div id="cultureContainer" class="space-y-4">
                    <!-- Culture articles will be loaded here dynamically -->
                </div>
            </section>

        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-black text-white py-6 border-t-4 border-gray-800">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm subhead-font tracking-wider mb-2">AMSTERDAM DISPATCH</p>
            <p class="text-xs mb-3">Curated from: NOS • AT5 • Het Parool • 112 Amsterdam • Amsterdamsdagblad • Politie.nl</p>
            <p class="text-xs text-gray-400" id="lastUpdated"></p>
            <p class="text-xs text-gray-500 mt-2">Automatic updates every 30 minutes</p>
        </div>
    </footer>

    <script>
        // Initial news data structure
        let newsData = {
            highlights: [],
            crime: [],
            politics: [],
            transport: [],
            culture: []
        };

        // Update current date and time
        function updateDateTime() {
            const now = new Date();
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = now.toLocaleDateString('en-US', dateOptions).toUpperCase();
            document.getElementById('currentDate').textContent = dateStr;
            
            const timeOptions = { hour: '2-digit', minute: '2-digit', hour12: false };
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', timeOptions);
        }
        
        updateDateTime();
        setInterval(updateDateTime, 60000);

        // Static category images - these never change
        const categoryImages = {
            highlight1: 'https://images.unsplash.com/photo-1563906267088-b029e7101114?w=800&h=400&fit=crop&q=80&sat=-100', // Breaking news
            highlight2: 'https://images.unsplash.com/photo-1541872703-74c5e44368f9?w=800&h=400&fit=crop&q=80&sat=-100', // Politics
            crime: 'https://images.unsplash.com/photo-1590642916589-592bca10dfbf?w=800&h=400&fit=crop&q=80&sat=-100', // Police/crime
            politics: 'https://images.unsplash.com/photo-1529107386315-e1a2ed48a620?w=800&h=400&fit=crop&q=80&sat=-100', // Government
            transport: 'https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=800&h=400&fit=crop&q=80&sat=-100', // Transport
            culture: 'https://images.unsplash.com/photo-1514306191717-452ec28c7814?w=800&h=400&fit=crop&q=80&sat=-100' // Culture/arts
        };

        // Render highlight article
        function renderHighlight(article, index) {
            const imageKey = `highlight${index}`;
            return `
                <article class="border-2 border-black p-6 bg-white fade-in">
                    <div class="mb-4">
                        <div class="w-full h-64 bg-gray-200 mb-4 highlight-image flex items-center justify-center">
                            <img src="${categoryImages[imageKey]}" 
                                 class="w-full h-full object-cover" 
                                 alt="${article.title}">
                        </div>
                    </div>
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs subhead-font tracking-wider border border-black px-2 py-1">${article.category || 'BREAKING NEWS'}</span>
                        <span class="text-xs subhead-font">${article.date}</span>
                    </div>
                    <h3 class="text-2xl headline-font mb-3 leading-tight">
                        <a href="${article.url}" target="_blank" class="hover:underline">
                            ${article.title}
                        </a>
                    </h3>
                    <p class="text-sm leading-relaxed mb-4">
                        ${article.description}
                    </p>
                    <div class="border-t border-gray-300 pt-3">
                        <p class="text-xs subhead-font mb-2">SOURCES: ${article.sources || article.source}</p>
                        <a href="${article.url}" target="_blank" class="text-xs subhead-font tracking-wider underline">
                            READ FULL DISPATCH →
                        </a>
                    </div>
                </article>
            `;
        }

        // Render regular article (crime, politics)
        function renderArticle(article) {
            return `
                <article class="news-card bg-white p-5 border-l-4 border-black fade-in">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs subhead-font tracking-wider">${article.source}</span>
                        <span class="text-xs">${article.date}</span>
                    </div>
                    <h3 class="text-lg headline-font mb-2 leading-tight">
                        <a href="${article.url}" target="_blank" class="hover:underline">
                            ${article.title}
                        </a>
                    </h3>
                    <p class="text-xs leading-relaxed">
                        ${article.description}
                    </p>
                </article>
            `;
        }

        // Render small article (transport, culture)
        function renderSmallArticle(article) {
            return `
                <article class="news-card bg-white p-4 border-l-4 border-black fade-in">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs subhead-font">${article.source}</span>
                        <span class="text-xs">${article.date}</span>
                    </div>
                    <h3 class="text-base headline-font mb-2">
                        <a href="${article.url}" target="_blank" class="hover:underline">
                            ${article.title}
                        </a>
                    </h3>
                    <p class="text-xs">${article.description}</p>
                </article>
            `;
        }

        // Render all news sections
        function renderNews() {
            // Render highlights
            document.getElementById('highlightsContainer').innerHTML = 
                newsData.highlights.map((article, idx) => renderHighlight(article, idx + 1)).join('');
            
            // Render crime
            document.getElementById('crimeContainer').innerHTML = 
                newsData.crime.map(article => renderArticle(article)).join('');
            
            // Render politics
            document.getElementById('politicsContainer').innerHTML = 
                newsData.politics.map(article => renderArticle(article)).join('');
            
            // Render transport
            document.getElementById('transportContainer').innerHTML = 
                newsData.transport.map(article => renderSmallArticle(article)).join('');
            
            // Render culture
            document.getElementById('cultureContainer').innerHTML = 
                newsData.culture.map(article => renderSmallArticle(article)).join('');
        }

        // Fetch latest news using Claude API with web search
        async function fetchLatestNews() {
            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 4000,
                        tools: [{ type: "web_search_20250305", name: "web_search" }],
                        messages: [{
                            role: "user",
                            content: `Search for the latest Amsterdam news TODAY from Dutch sources (AT5, Het Parool, NOS, 112 Amsterdam, Politie.nl). 
                            
Find and organize into categories:
1. HIGHLIGHTS (2 major stories covered by multiple sources)
2. CRIME (4-5 stories)
3. POLITICS (3-4 stories)
4. TRANSPORT (2 stories)
5. CULTURE (2-3 stories)

For each story provide in this exact format:
CATEGORY: [category]
TITLE: [headline]
SOURCE: [source name]
SOURCES: [if highlight, list all covering it]
DATE: [e.g., JAN 13]
DESCRIPTION: [2-3 sentences]
URL: [link to article]
---

Make descriptions concise and newspaper-style. Focus on today's news.`
                        }]
                    })
                });

                const data = await response.json();
                return parseNewsResponse(data);
            } catch (error) {
                console.error('Error fetching news:', error);
                return null;
            }
        }

        // Parse Claude's response into structured data
        function parseNewsResponse(data) {
            let newsText = '';
            if (data.content) {
                for (const item of data.content) {
                    if (item.type === 'text') {
                        newsText += item.text + '\n';
                    }
                }
            }

            const articles = newsText.split('---').filter(section => section.trim());
            const parsed = {
                highlights: [],
                crime: [],
                politics: [],
                transport: [],
                culture: []
            };

            articles.forEach(article => {
                const lines = article.split('\n').filter(l => l.trim());
                const articleData = {};
                
                lines.forEach(line => {
                    if (line.includes('CATEGORY:')) articleData.category = line.split('CATEGORY:')[1].trim();
                    if (line.includes('TITLE:')) articleData.title = line.split('TITLE:')[1].trim();
                    if (line.includes('SOURCE:') && !line.includes('SOURCES:')) articleData.source = line.split('SOURCE:')[1].trim();
                    if (line.includes('SOURCES:')) articleData.sources = line.split('SOURCES:')[1].trim();
                    if (line.includes('DATE:')) articleData.date = line.split('DATE:')[1].trim();
                    if (line.includes('DESCRIPTION:')) articleData.description = line.split('DESCRIPTION:')[1].trim();
                    if (line.includes('URL:')) articleData.url = line.split('URL:')[1].trim();
                });

                if (articleData.title && articleData.category) {
                    const cat = articleData.category.toLowerCase();
                    if (cat.includes('highlight')) parsed.highlights.push(articleData);
                    else if (cat.includes('crime')) parsed.crime.push(articleData);
                    else if (cat.includes('politic')) parsed.politics.push(articleData);
                    else if (cat.includes('transport')) parsed.transport.push(articleData);
                    else if (cat.includes('culture')) parsed.culture.push(articleData);
                }
            });

            return parsed;
        }

        // Refresh news function
        async function refreshNews() {
            const btn = document.getElementById('refreshBtn');
            const icon = document.getElementById('refreshIcon');
            const overlay = document.getElementById('loadingOverlay');
            
            btn.disabled = true;
            icon.classList.add('spinning');
            overlay.classList.remove('hidden');
            
            try {
                const newNews = await fetchLatestNews();
                
                if (newNews && (newNews.highlights.length > 0 || newNews.crime.length > 0)) {
                    newsData = newNews;
                    renderNews();
                    
                    const now = new Date();
                    const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                    document.getElementById('lastUpdated').textContent = 
                        `Last Edition: ${now.toLocaleDateString('en-US', dateOptions)}`;
                    
                    showNotification('✓ Edition Updated - Fresh News Loaded');
                } else {
                    throw new Error('No news data received');
                }
                
            } catch (error) {
                console.error('Error refreshing:', error);
                showNotification('⚠ Using Cached Edition', 'warning');
                
                const now = new Date();
                const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                document.getElementById('lastUpdated').textContent = 
                    `Last Edition: ${now.toLocaleDateString('en-US', dateOptions)}`;
            } finally {
                setTimeout(() => {
                    btn.disabled = false;
                    icon.classList.remove('spinning');
                    overlay.classList.add('hidden');
                }, 500);
            }
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-24 right-4 z-50 px-6 py-3 border-2 border-black shadow-lg ${
                type === 'success' ? 'bg-white' : 'bg-gray-100'
            } text-black subhead-font text-sm tracking-wider`;
            notification.textContent = message;
            notification.style.opacity = '0';
            
            document.body.appendChild(notification);
            
            setTimeout(() => { notification.style.opacity = '1'; }, 10);
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Load initial fallback news
        function loadFallbackNews() {
            newsData = {
                highlights: [
                    {
                        title: "Series of Explosions Target Pizzabakkers Chain—Third Suspect Arrested",
                        description: "A wave of explosions has targeted multiple locations of the Pizzabakkers restaurant chain in Amsterdam since late August. Four locations were temporarily closed by the deputy mayor after explosions at Plantage Kerklaan (two locations) and Overtoom. A 24-year-old Amsterdam man was arrested as the third suspect.",
                        source: "NOS",
                        sources: "NOS, AT5, Het Parool, Crime Nieuws",
                        date: "DEC 8",
                        url: "https://nos.nl",
                        category: "ONGOING INVESTIGATION"
                    },
                    {
                        title: "D66 and CDA Present Coalition Framework—Major Impact on Amsterdam",
                        description: "Political parties D66 and CDA have presented a 17-page coalition framework that will significantly impact Amsterdam. Key proposals include restoring the 30% expat tax ruling, building 100,000 homes annually, and stricter migration measures.",
                        source: "NOS",
                        sources: "NOS, NL Times, Rijksoverheid",
                        date: "DEC 2",
                        url: "https://nos.nl",
                        category: "NATIONAL POLITICS"
                    }
                ],
                crime: [
                    {
                        title: "Third Suspect Arrested in Pizzabakkers Investigation",
                        description: "Police arrested a 24-year-old Amsterdam man suspected of involvement in explosions at multiple Pizzabakkers locations.",
                        source: "Politie",
                        date: "DEC 8",
                        url: "https://www.politie.nl/nieuws"
                    },
                    {
                        title: "Vehicle Fire on A8 Highway",
                        description: "A German Audi caught fire on the A8 highway near Oostzaan. Emergency services responded quickly.",
                        source: "112 Amsterdam",
                        date: "DEC 7",
                        url: "https://112amsterdam.nl/"
                    },
                    {
                        title: "Apartment Fire at Burgemeester Fockstraat",
                        description: "A fire broke out in a basement storage unit during early morning hours. Firefighters contained the blaze.",
                        source: "112 Amsterdam",
                        date: "DEC 7",
                        url: "https://112amsterdam.nl/"
                    },
                    {
                        title: "Major Fire at Business in Amsterdam-West",
                        description: "Significant fire at Van Slingelandtstraat caused considerable smoke and disruption.",
                        source: "112 Amsterdam",
                        date: "DEC 6",
                        url: "https://112amsterdam.nl/"
                    }
                ],
                politics: [
                    {
                        title: "CDA Returns to Amsterdam Politics After Two Decades",
                        description: "The CDA party aims to return to Amsterdam city council after 20 years, focusing on public safety.",
                        source: "Het Parool",
                        date: "DEC 4",
                        url: "https://www.parool.nl"
                    },
                    {
                        title: "Fire Chief Tijs van Lieshout to Step Down",
                        description: "Van Lieshout ending tenure as head of Amsterdam fire department's emergency services.",
                        source: "Het Parool",
                        date: "DEC 4",
                        url: "https://www.parool.nl"
                    }
                ],
                transport: [
                    {
                        title: "Sloterweg Traffic Ban Continues",
                        description: "Analysis shows safety improvements since implementation.",
                        source: "Het Parool",
                        date: "DEC 3",
                        url: "https://www.parool.nl"
                    },
                    {
                        title: "E-Bike Battery Fire Risks Rising",
                        description: "Parking facilities face increased danger from e-bikes and fat bikes.",
                        source: "Het Parool",
                        date: "DEC 2",
                        url: "https://www.parool.nl"
                    }
                ],
                culture: [
                    {
                        title: "Van der Vaart Signs at Ajax Shop",
                        description: "Former Ajax star drew large crowds signing his biography.",
                        source: "AT5",
                        date: "DEC 6",
                        url: "https://www.at5.nl/nieuws"
                    },
                    {
                        title: "5,500 New Homes for Zuidoost",
                        description: "Holterberg district plan addresses housing shortage.",
                        source: "Het Parool",
                        date: "DEC 4",
                        url: "https://www.parool.nl"
                    }
                ]
            };
            renderNews();
        }
        
        // Auto-refresh every 30 minutes
        setInterval(refreshNews, 30 * 60 * 1000);
        
        // Initialize
        loadFallbackNews();
        updateDateTime();
        const now = new Date();
        const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
        document.getElementById('lastUpdated').textContent = 
            `Last Edition: ${now.toLocaleDateString('en-US', dateOptions)}`;
            
        // Try to fetch fresh news on first load (optional - remove if you want manual refresh only)
        // setTimeout(() => refreshNews(), 2000);
    </script>

</body>
</html>
